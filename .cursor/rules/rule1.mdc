---
description: Bug Handling Workflow Rules (Used in fixing BUGS in code only)
alwaysApply: true
---
# Bug Handling Workflow Rules

**PURPOSE:** Systematic methodology for identifying, analyzing, and resolving bugs efficiently.
**WHEN TO APPLY:** Errors, warnings, unexpected behavior, test failures, or code malfunctions.
**CORE PRINCIPLE:** Root Cause Analysis (RCA) - Solve problems at their source. Research, analyze, verify.

---

## QUICK DECISION TREE

```
Bug Detected → Can reproduce? → NO → Gather info (logs, conditions)
             ↓ YES
Error message clear? → YES → Phase 2 (Locate)
             ↓ NO
Intermittent/flaky? → YES → Add logging, monitor
             ↓ NO
Follow 4-Phase Workflow ↓
```

---

## THE 4-PHASE WORKFLOW

### PHASE 1: REPRODUCE & UNDERSTAND
**Goal:** Confirm bug exists and understand scope.
**Steps:**
1. **Reproduce:** ≥3 times with same steps. Document trigger, conditions (OS, inputs, env).
2. **Gather Evidence:** Error messages (stack traces), Logs, Recent changes (git), Env details.
3. **Define:** Severity, Scope (function/system), Type (Logic/Runtime/etc), Frequency.
**Tools:** Cursor Diagnostics, Terminal, Git history.

### PHASE 2: LOCATE ROOT CAUSE
**Goal:** Pinpoint exact code location.
**Strategies:**
A. **Stack Trace:** Use `mcp_serena_get_symbols_overview` → `find_symbol` (include body) → `find_referencing_symbols`.
B. **Pattern Search:** If unknown, use `mcp_serena_search_for_pattern` or Cursor Search.
C. **Binary Search:** Comment out code halves to isolate.
**Tools:** Serena MCP (`find_symbol`, `find_referencing_symbols`), Cursor Debugger.

### PHASE 3: RESEARCH SOLUTIONS
**Goal:** Find proven solutions using `exa` (web) and `grep github` (github).
**Checklist:** Stack Overflow, GitHub Issues, Official Docs.

### PHASE 4: IMPLEMENT & TEST FIX
**Goal:** Apply solution without new bugs.
**Pre-Implementation Check:**
- Understand root cause (not symptoms).
- Check impact: `mcp_serena_find_referencing_symbols`.
- Backup state.
**Implementation:**
- Minimal changes.
- Add defensive code (null checks, validation).
- Add comments explaining WHY.
- Follow code style.
**Testing Levels:**
1. Unit Test (`pytest ...`)
2. Reproduce (should fail)
3. Regression Test (`pytest`)
4. Linter (`read_lints`)
5. Manual Testing

---

## TOOL DECISION MATRIX

| Task | Tool |
|---|---|
| Find error location | Serena (`get_symbols_overview` → `find_symbol`) |
| Trace code flow | Serena (`find_referencing_symbols`) |
| Research solutions | Brightdata + Exa |
| GitHub examples | Grep Github |
| Run tests | Terminal (`pytest`) |
| Check errors | Cursor (Diagnostics, `read_lints`) |

---

## BEST PRACTICES

**DO's:** Reproduce first, Use Version Control, Test Thoroughly, Document Root Cause, Systematic Approach.
**DON'Ts:** Guess & Commit, Fix Symptoms Only, Skip Testing, Ignore Warnings, Rush.

---

## REAL-WORLD EXAMPLE (Summary)
**Bug:** "Cannot read property 'map' of undefined"
**Locate:** Trace stack trace to `data.map(...)`.
**Root Cause:** API returns null when no data, missing check.
**Fix:** Add `if (!data || !Array.isArray(data)) return;` before map.
**Verify:** Null case handled, valid data works.

---

## COMPLETION CHECKLIST
- [ ] Bug consistently reproducible & Root cause identified.
- [ ] Research completed & Minimal changes made.
- [ ] Original bug fixed & Tests pass.
- [ ] No new linter errors & Code documented.