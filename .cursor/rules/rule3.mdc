---
description: Using Tools Rule
alwaysApply: true
---
# Using Tools Rule

**PURPOSE:** Define clear separation of concerns between code analysis (Serena MCP) and code editing (Cursor built-in tools) for AI assistants.

---

## üéØ Core Philosophy: Separation of Concerns

### GOLDEN RULE
```
Serena MCP  = UNDERSTAND code (analysis, navigation, exploration)
Cursor Tools = MODIFY code (editing, refactoring, formatting)
```

**NEVER cross this boundary.** Serena does NOT edit. Cursor does NOT analyze symbols.

---

## ‚ö†Ô∏è CRITICAL PRINCIPLE: Intelligent Reading Strategy

### THE MOST IMPORTANT RULE
**DO NOT READ ENTIRE FILES UNLESS ABSOLUTELY NECESSARY!**

This is not a suggestion‚Äîthis is a hard requirement. Reading full files:
- ‚ùå Wastes context window tokens
- ‚ùå Slows down analysis
- ‚ùå Makes it harder to find relevant code
- ‚ùå Violates Serena's core design philosophy

### The Intelligent Reading Hierarchy (ALWAYS follow this order)

```
Step 1: OVERVIEW     ‚Üí get_symbols_overview (table of contents)
   ‚Üì (if need more detail)
Step 2: SYMBOL LOOKUP ‚Üí find_symbol (specific class/function)
   ‚Üì (if need relationships)
Step 3: REFERENCES   ‚Üí find_referencing_symbols (who uses this?)
   ‚Üì (ONLY if above insufficient)
Step 4: TARGETED READ ‚Üí read_file with line ranges (small slices)
   ‚Üì (ABSOLUTE LAST RESORT)
Step 5: FULL FILE    ‚Üí read_file without ranges (rare!)
```

### When is Full File Reading Justified?
ONLY in these scenarios:
1. **Config files** (JSON, YAML, .env) - they're small and need full context
2. **Documentation** (README.md, docs) - meant to be read as a whole
3. **Small files** (<100 lines) - minimal cost
4. **Already tried Steps 1-4** and still missing critical information

### Examples of WRONG vs RIGHT Approach

‚ùå **WRONG:** User asks "How does the authentication system work?"
```
read_file("src/auth/service.py")  # 800 lines!
read_file("src/auth/middleware.py")  # 500 lines!
```

‚úÖ **RIGHT:** 
```
1. get_symbols_overview("src/auth/service.py")  # See AuthService, login(), verify_token()
2. find_symbol("AuthService", "src/auth/service.py", depth=1)  # Get methods list
3. find_symbol("AuthService/login", include_body=True)  # Read ONLY login method
4. find_referencing_symbols("AuthService", "src/auth/service.py")  # Who uses it?
```
*Result: Read only 50 lines instead of 1300 lines*

---

## üîç Investigation Workflow (Serena MCP Only)

### Phase 1: Session Initialization
```python
# ALWAYS start with these
mcp_serena_activate_project("project_name")
mcp_serena_list_memories()  # Load existing knowledge
mcp_serena_read_memory("project-overview-and-status")  # Context
```

### Phase 2: High-Level Discovery
**Goal:** Understand structure WITHOUT reading code  
**Tools:** `list_dir()` for tree, `get_symbols_overview()` for table of contents

### Phase 3: Targeted Symbol Navigation
**Goal:** Find exact locations  
**Tools:** `find_symbol(name_path, path, include_body=False/True, depth=0/1)`  
**Name Paths:** `"Class"`, `"/Class"` (top-level), `"Class/method"`, `"/Class/method"` (absolute)

### Phase 4: Relationship Mapping
**Goal:** Understand dependencies  
**Tools:** `find_referencing_symbols(name, path)` - Who calls this?

### Phase 5: Targeted Reading
**Goal:** Read ONLY necessary code  
**Tools:** `read_file(path, start_line, end_line)` - Always use line ranges!

### Phase 6: Pattern Search
**Goal:** Find by pattern when name unknown  
**Tools:** `search_for_pattern(pattern, path, glob)`

---

## ‚úèÔ∏è Editing Workflow (Cursor Built-in Tools Only)

### Pre-Edit Checklist
- [ ] Have you completed Serena analysis?
- [ ] Do you understand the impact of your change? (used `find_referencing_symbols`?)
- [ ] Did you call `think_about_task_adherence` before editing?
- [ ] Is your plan confirmed with the user?

### Editing Tools (Cursor ONLY)
1. **Direct editing** - Type in the editor
2. **Find & Replace** - Bulk text changes
3. **Multi-cursor** - Edit multiple locations simultaneously
4. **Refactor menu** - Rename symbol, extract method, etc.
5. **Code actions** - Quick fixes, organize imports

### Post-Edit Checklist
- [ ] Run linter: Check Cursor Diagnostics/Problems panel
- [ ] Run tests: Use terminal with `--non-interactive` flags
- [ ] Review diff: Use Cursor Diff viewer
- [ ] Update memory: If architectural change, call `write_memory`

---

## üó∫Ô∏è Task-to-Tool Decision Matrix

| Task | Use | Tool | Why |
|------|-----|------|-----|
| **"Find where X is defined"** | Serena | `find_symbol` | Symbolic search |
| **"Who calls function Y?"** | Serena | `find_referencing_symbols` | Cross-file analysis |
| **"List all classes in file"** | Serena | `get_symbols_overview` | Structure overview |
| **"Read implementation of method Z"** | Serena | `find_symbol` + `include_body=True` | Targeted read |
| **"Search for TODO comments"** | Cursor | Search/Grep panel | Text search |
| **"Navigate to definition"** | Cursor | Cmd/Ctrl + Click | Quick navigation |
| **"Rename variable across project"** | Cursor | Refactor ‚Üí Rename | AST-based refactor |
| **"Fix syntax error"** | Cursor | Editor + Diagnostics | Code modification |
| **"Format code"** | Cursor | Format Document | Style enforcement |
| **"Add new function"** | Cursor | Editor | Code creation |
| **"Understand data flow"** | Serena | `find_symbol` + `find_referencing_symbols` | Trace relationships |
| **"Read config file"** | Serena | `read_file` (full) | Small, needs context |

---

## üìö Tool Reference Quick Guide

### Serena MCP (Analysis Only)

| Tool | When | Key Points |
|------|------|-----------|
| `activate_project(name)` | First action | Initialize session |
| `list_memories()` / `read_memory(name)` | After activation | Load context |
| `list_dir(path, recursive)` | Need structure | Get file tree |
| `get_symbols_overview(path)` | First time in file | Table of contents |
| `find_symbol(name_path, path, include_body, depth)` | Know name | `include_body=False` (fast), `=True` (full code) |
| `find_referencing_symbols(name, path)` | Check usage | Who calls this? |
| `read_file(path, start, end)` | Need exact slice | Always use line ranges |
| `search_for_pattern(pattern, path, glob)` | Pattern search | When name unknown |
| `think_about_*()` | Meta-thinking | Before conclusions/edits |

**Name Path Patterns:** `"ClassName"`, `"/ClassName"` (top-level), `"ClassName/method"`, `"/ClassName/method"` (absolute)

### Cursor Built-in (Editing & Navigation)

| Tool | When | Use For |
|------|------|---------|
| Explorer | Visual nav | Browse, create/delete files |
| Search/Grep | Exact text | Strings, TODOs, regex |
| Codebase Search | Semantic | Concepts, features |
| Editor | Code changes | Write, modify, delete |
| Find & Replace | Bulk changes | Update patterns |
| Refactor | Structure | Rename, extract, move |
| Diagnostics | After edits | Check errors |
| Diff Viewer | Pre-commit | Review changes |
| Terminal | Run commands | Tests, builds (use `--non-interactive`) |

---

## üéì Real-World Scenarios

### Scenario 1: "Fix bug in user registration"
**‚ùå WRONG:** Read entire files (1700 lines)  
**‚úÖ RIGHT:** 
```python
get_symbols_overview("src/routes/auth.py")  # Find register_route
find_symbol("register_route", "src/routes/auth.py", include_body=True)  # ~20 lines
find_symbol("UserService/create_user", "src/services/user.py", include_body=True)  # ~30 lines
# Total: ~50 lines, found bug!
```

### Scenario 2: "Add email verification feature"
**Analysis (Serena):**
```python
search_for_pattern(r"email", "src/", paths_include_glob="*.py")
find_symbol("EmailService", relative_path="", substring_matching=True)
find_referencing_symbols("EmailService", "src/services/email.py")
find_symbol("EmailService/send", "src/services/email.py", include_body=True)
```
**Editing (Cursor):** Add verify_email() method, create token model, add route, update flow

---

## üö® Common Anti-Patterns to AVOID

1. **Reading Files You Already Read** - Don't `read_file` then `find_symbol` on same file
2. **Using Serena to Edit** - NEVER use `replace_symbol_body`, `insert_after_symbol`. Use Cursor editor!
3. **Reading Full Files First** - Always `get_symbols_overview` ‚Üí `find_symbol` ‚Üí targeted read
4. **Skipping Relationship Analysis** - Always `find_referencing_symbols` before major changes

---

## üìã Quick Reference Cheat Sheet

### When to Use Which Tool

| Situation | Tool Chain |
|-----------|------------|
| **New file, never seen before** | `get_symbols_overview` ‚Üí `find_symbol` (specific parts) |
| **Find specific function/class** | `find_symbol` with name |
| **Understand how X is used** | `find_referencing_symbols` |
| **Search for pattern** | `search_for_pattern` OR Cursor Search |
| **Read small config file** | `read_file` (full) |
| **Read part of large file** | `find_symbol` OR `read_file` with ranges |
| **Navigate quickly** | Cursor Explorer + Cmd/Ctrl+Click |
| **Edit code** | Cursor Editor (NEVER Serena) |
| **Rename across project** | Cursor Refactor ‚Üí Rename |
| **Check for errors** | Cursor Diagnostics/Problems |
| **Run tests** | Cursor Terminal |

---

## üí° Remember These Principles

1. **Analysis ‚â† Editing** - Different tools, different purposes
2. **Overview ‚Üí Symbol ‚Üí Detail** - Always follow this hierarchy
3. **Read less, understand more** - Symbolic tools save tokens
4. **Verify before editing** - Use `find_referencing_symbols`
5. **Think before acting** - Use meta-thinking tools
6. **Communicate clearly** - Surface uncertainties early
7. **Keep changes minimal** - Fix only what's needed

---

## üéØ Success Metrics

You're doing it right when:
- ‚úÖ You read <10% of a large file to understand key logic
- ‚úÖ You use `get_symbols_overview` before `read_file`
- ‚úÖ You never use Serena editing tools
- ‚úÖ You check references before refactoring
- ‚úÖ You can trace code flow without reading entire files

You're doing it wrong when:
- ‚ùå You read entire files "just to see what's there"
- ‚ùå You read the same content multiple times
- ‚ùå You use Serena tools to edit code
- ‚ùå You skip relationship analysis
- ‚ùå You edit without understanding impact
